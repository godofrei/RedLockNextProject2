<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Red Lock — 1v1 Mini Oyun (Mobil + PC)</title>
<style>
  :root{--bg:#071013;--accent:crimson}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Arial,Helvetica,sans-serif}
  .center{display:flex;align-items:center;justify-content:center;flex-direction:column}
  header{padding:18px 12px 6px;text-align:center}
  h1{color:var(--accent);margin:6px 0;font-size:22px}
  p.slogan{margin:6px 0 12px;color:#ddd;font-size:13px;text-align:center}
  .btn{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;margin:6px}
  #app{max-width:1000px;margin:0 auto;padding:12px}
  #cover{min-height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center}
  /* game area */
  #gameArea{display:none;flex-direction:column;align-items:center;gap:10px;padding:6px}
  #hud{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap}
  #score,#timer{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;font-weight:700}
  #canvasWrap{position:relative;width:100%;max-width:900px}
  canvas{width:100%;height:auto;display:block;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,0.6);background:#2f8b2c}
  /* mobile controls - visible under 820px and when game started */
  .mobileControls{display:none;gap:12px;width:100%;max-width:900px;justify-content:space-between;align-items:center;margin-top:8px}
  .dPad{display:flex;flex-direction:column;gap:6px;align-items:center}
  .dPad .row{display:flex;gap:6px}
  .ctrlBtn{background:rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.06);color:#fff;padding:12px;border-radius:8px;font-weight:700}
  .shootBtn{background:var(--accent);border:none;padding:12px 18px;border-radius:10px;color:#fff;font-weight:800}
  /* character modal */
  #charPanel{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;z-index:80}
  .panel{background:#071418;padding:16px;border-radius:10px;max-width:420px;width:92%}
  .chars{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .charCard{background:#0c1416;padding:10px;border-radius:10px;width:110px;cursor:pointer;border:2px solid transparent;display:flex;flex-direction:column;align-items:center}
  .charCard.active{border-color:var(--accent)}
  .charName{margin-top:8px;text-align:center;font-weight:700}
  /* result overlay */
  #resultOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;z-index:90}
  .resultBox{background:#081015;padding:18px;border-radius:10px;text-align:center;width:90%;max-width:360px}
  @media (max-width:820px){
    .mobileControls{display:flex}
    #hud{flex-direction:column}
  }
</style>
</head>
<body>
<div id="app">
  <header class="center">
    <h1>RED LOCK'A HOŞGELDİNİZ</h1>
    <p class="slogan">"EGOİST OLMAK SADECE KENDİNİ BEĞENMİŞLİK DEĞİLDİR"</p>
  </header>

  <!-- COVER -->
  <section id="cover" class="center">
    <button class="btn" id="readBtn">Okumaya Başla</button>
    <button class="btn" id="playBtn">Mini Oyun Oyna</button>
  </section>

  <!-- GAME AREA -->
  <section id="gameArea" class="center">
    <div id="hud">
      <div id="score">Goller: 0 / 10</div>
      <div id="timer">Süre: 1:30</div>
    </div>

    <div id="canvasWrap">
      <canvas id="gameCanvas" width="960" height="600"></canvas>
    </div>

    <div class="mobileControls" id="mobileControls" aria-hidden="true">
      <div class="dPad">
        <div class="row"><button class="ctrlBtn" id="upBtn">▲</button></div>
        <div class="row"><button class="ctrlBtn" id="leftBtn">◀</button><button class="ctrlBtn" id="downBtn">▼</button><button class="ctrlBtn" id="rightBtn">▶</button></div>
      </div>
      <div>
        <button class="shootBtn" id="shootBtn">Şut</button>
      </div>
    </div>
  </section>
</div>

<!-- character modal -->
<div id="charPanel" class="center" aria-hidden="true">
  <div class="panel">
    <h3 style="margin:0 0 6px">Karakter Seç</h3>
    <p style="margin:0 0 8px;color:#ddd;font-size:13px">Takımından birini seç: Rei, Nagi, Bachira veya Rin</p>
    <div class="chars" id="chars"></div>
    <div style="text-align:center;margin-top:12px">
      <button class="btn" id="startMatchBtn">Maça Başla</button>
    </div>
  </div>
</div>

<!-- result overlay -->
<div id="resultOverlay" class="center" aria-hidden="true">
  <div class="resultBox">
    <h2 id="resultTitle">Sonuç</h2>
    <p id="resultText"></p>
    <div style="margin-top:12px">
      <button class="btn" id="replayBtn">Tekrar Oyna</button>
      <button class="btn" id="backBtn">Ana Sayfaya Dön</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
  Tam Çalışır: Kapak+Oyun+Mobil
   - Kaydet: index.html
   - Masaüstü: WASD/oklar + Space
   - Mobil: alt D-pad + Şut
  ------------------------- */

const FIELD_W = 1600, FIELD_H = 1000;
const GOAL_POST_X = FIELD_W - 40;
const GOAL_TOP = FIELD_H/2 - 110, GOAL_BOTTOM = FIELD_H/2 + 110;

const characters = [
  { id:'Rei', color:'#1E90FF', power:1.6, accuracy:0.86 },
  { id:'Nagi', color:'#FFD24D', power:1.35, accuracy:0.80 },
  { id:'Bachira', color:'#FF7A2E', power:1.5, accuracy:0.82 },
  { id:'Rin', color:'#9B59B6', power:1.3, accuracy:0.88 },
];
const opponent = { id:'Isagi', color:'#E33A3A', agility:2.2 };

/* DOM */
const cover = document.getElementById('cover'),
      playBtn = document.getElementById('playBtn'),
      charPanel = document.getElementById('charPanel'),
      charsWrap = document.getElementById('chars'),
      startMatchBtn = document.getElementById('startMatchBtn'),
      gameArea = document.getElementById('gameArea'),
      canvas = document.getElementById('gameCanvas'),
      ctx = canvas.getContext('2d'),
      scoreEl = document.getElementById('score'),
      timerEl = document.getElementById('timer'),
      mobileControls = document.getElementById('mobileControls'),
      resultOverlay = document.getElementById('resultOverlay'),
      resultTitle = document.getElementById('resultTitle'),
      resultText = document.getElementById('resultText'),
      replayBtn = document.getElementById('replayBtn'),
      backBtn = document.getElementById('backBtn');

let DPR = window.devicePixelRatio || 1;
function resizeCanvas(){
  const wrapW = Math.min(window.innerWidth - 24, 960);
  const ratio = 960/600;
  const w = wrapW;
  const h = Math.round(w / ratio);
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  canvas.width = Math.round(w * DPR);
  canvas.height = Math.round(h * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* state */
let state='cover', selectedChar = characters[0];
let player, keeper, ball;
let goals = 0, timeLeft = 90;
let rafId = null, timerId = null;
let keys = {};
let isMobile = /Mobi|Android/i.test(navigator.userAgent);

/* mobile button wiring */
const mobileBtnIds = ['upBtn','downBtn','leftBtn','rightBtn','shootBtn'];
mobileBtnIds.forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('touchstart', (e)=>{ e.preventDefault(); keys[id]=true; });
  el.addEventListener('touchend', (e)=>{ e.preventDefault(); keys[id]=false; });
  el.addEventListener('mousedown', ()=> keys[id]=true);
  el.addEventListener('mouseup', ()=> keys[id]=false);
});

/* keyboard */
window.addEventListener('keydown', (e)=>{ keys[e.key.toLowerCase()] = true; if(e.key===' ') e.preventDefault(); });
window.addEventListener('keyup', (e)=>{ keys[e.key.toLowerCase()] = false; });

/* UI handlers */
document.getElementById('readBtn').addEventListener('click', ()=>alert('Hikaye sayfasına yönlendir.'));
playBtn.addEventListener('click', openCharPanel);
startMatchBtn.addEventListener('click', ()=>{ closeCharPanel(); startMatch(); });
replayBtn.addEventListener('click', ()=>{ resultOverlay.style.display='none'; openCharPanel(); });
backBtn.addEventListener('click', ()=>{ resultOverlay.style.display='none'; resetToCover(); });

/* open character modal and render cards */
function openCharPanel(){
  cover.style.display='none';
  charPanel.style.display='flex';
  state='selecting';
  charsWrap.innerHTML='';
  characters.forEach((c,idx)=>{
    const div = document.createElement('div');
    div.className = 'charCard' + (idx===0?' active':'');
    div.innerHTML = `<div style="height:64px;display:flex;align-items:center;justify-content:center">
      <canvas width="96" height="96" style="width:64px;height:64px;border-radius:6px"></canvas></div>
      <div class="charName">${c.id}</div>`;
    div.addEventListener('click', ()=>{ [...charsWrap.children].forEach(ch=>ch.classList.remove('active')); div.classList.add('active'); selectedChar = c; });
    charsWrap.appendChild(div);
    // draw small sprite
    const cv = div.querySelector('canvas'), ct = cv.getContext('2d');
    ct.fillStyle = c.color; ct.fillRect(14,22,52,40);
    ct.beginPath(); ct.fillStyle='#f3d7bc'; ct.arc(40,14,10,0,Math.PI*2); ct.fill();
  });
  selectedChar = characters[0];
  // show mobile controls if mobile
  if(isMobile) mobileControls.style.display='flex';
}

/* close panel */
function closeCharPanel(){ charPanel.style.display='none'; }

/* initialize game objects and start */
function startMatch(){
  state='playing';
  gameArea.style.display='flex';
  if(isMobile) mobileControls.style.display='flex';
  // logical positions
  player = { x:150, y: FIELD_H/2, speed:700, color:selectedChar.color, name:selectedChar.id };
  keeper = { x: FIELD_W - 240, y: FIELD_H/2, speed:opponent.agility*220, color:opponent.color, name:opponent.id };
  ball = { x: player.x + 80, y: player.y, vx:0, vy:0, inMotion:false };
  goals = 0; timeLeft = 90;
  scoreEl.textContent = `Goller: ${goals} / 10`;
  timerEl.textContent = `Süre: 1:30`;
  // start timer
  if(timerId) clearInterval(timerId);
  timerId = setInterval(()=>{ timeLeft--; if(timeLeft<=0){ clearInterval(timerId); endMatch(false); } }, 1000);
  // start RAF loop
  if(rafId) cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(loop);
}

/* loop */
let prevTs = performance.now();
function loop(ts){
  const dt = Math.min(0.05, (ts - prevTs)/1000); prevTs = ts;
  if(state==='playing'){ update(dt); render(); rafId = requestAnimationFrame(loop); }
}

/* input mapping helper */
function isPressed(key){
  if(key==='up') return keys['w']||keys['arrowup']||keys['upbtn']||keys['upBtn']||keys['upbtn'];
  if(key==='down') return keys['s']||keys['arrowdown']||keys['downbtn']||keys['downBtn'];
  if(key==='left') return keys['a']||keys['arrowleft']||keys['leftbtn']||keys['leftBtn'];
  if(key==='right') return keys['d']||keys['arrowright']||keys['rightbtn']||keys['rightBtn'];
  if(key==='shoot') return keys[' ']||keys['shootbtn']||keys['shootBtn'];
  return !!keys[key];
}

/* update game state */
function update(dt){
  // movement
  let mx = 0, my = 0;
  if(isPressed('left')) mx -= 1;
  if(isPressed('right')) mx += 1;
  if(isPressed('up')) my -= 1;
  if(isPressed('down')) my += 1;
  if(mx !== 0 || my !== 0){
    const len = Math.hypot(mx,my) || 1;
    player.x += (mx/len) * player.speed * dt;
    player.y += (my/len) * player.speed * dt;
  }
  // clamp player
  player.x = Math.max(60, Math.min(FIELD_W - 420, player.x));
  player.y = Math.max(80, Math.min(FIELD_H - 80, player.y));

  // shoot
  if(isPressed('shoot') && !ball.inMotion){
    doShoot();
    // prevent continuous immediate repeated shoot on mobile by clearing the key (user still must release)
    keys['shootbtn'] = false; keys['shootBtn'] = false;
  }

  // ball follows player if not shot
  if(!ball.inMotion){
    ball.x = player.x + 80;
    ball.y = player.y;
  } else {
    // physics integration (vx, vy in px/s)
    ball.x += ball.vx * dt;
    ball.y += ball.vy * dt;
    // simple air drag
    ball.vx *= Math.pow(0.995, dt*1000);
    ball.vy *= Math.pow(0.995, dt*1000);
  }

  // keeper AI: predict and move vertically
  keeperAI(dt);

  // keeper intercept
  if(ball.inMotion){
    const kdx = keeper.x - ball.x, kdy = keeper.y - ball.y;
    const kdist = Math.hypot(kdx,kdy);
    if(kdist < 70){
      const chance = Math.min(0.9, 0.45 + (opponent.agility-2)*0.12 + (70-kdist)/140);
      if(Math.random() < chance){
        // deflect
        ball.vx = -Math.abs(ball.vx) * (0.35 + Math.random()*0.45);
        ball.vy += rnd(-200,200);
      }
    }
  }

  // goal detection
  if(ball.inMotion && ball.x > GOAL_POST_X && ball.vx > 0){
    if(ball.y > GOAL_TOP && ball.y < GOAL_BOTTOM){
      // goal
      goals++;
      scoreEl.textContent = `Goller: ${goals} / 10`;
      flash('#6bee8a');
      resetAfterGoal();
      if(goals >= 10){ endMatch(true); }
    } else {
      // missed -> out
      if(ball.x > FIELD_W + 80 || ball.y < 0 || ball.y > FIELD_H){ resetBall(); }
    }
  }

  // bounds
  if(ball.y < 10){ ball.y = 10; ball.vy *= -0.4; }
  if(ball.y > FIELD_H - 10){ ball.y = FIELD_H - 10; ball.vy *= -0.4; } 
}

/* keeper AI */
function keeperAI(dt){
  if(ball.inMotion && ball.vx > 0 && ball.x > FIELD_W/2){
    const t = (keeper.x - ball.x) / (ball.vx || 0.0001);
    const predictedY = ball.y + (ball.vy || 0) * Math.max(0,t);
    const dir = Math.sign(predictedY - keeper.y);
    keeper.y += dir * keeper.speed * dt;
  } else {
    // return to center
    const dir = Math.sign(FIELD_H/2 - keeper.y);
    keeper.y += dir * keeper.speed * 0.45 * dt;
  }
  keeper.y = Math.max(100, Math.min(FIELD_H - 100, keeper.y));
}

/* shoot: set ball velocity toward goal with power+spread */
function doShoot(){
  if(ball.inMotion) return;
  const gx = FIELD_W - 60, gy = FIELD_H/2;
  const dx = gx - ball.x, dy = gy - ball.y;
  const dist = Math.hypot(dx,dy) || 1;
  const nx = dx / dist, ny = dy / dist;
  const power = 1500 * selectedChar.power;
  const spread = (1 - selectedChar.accuracy) * 220;
  const rx = rnd(-spread, spread);
  const ry = rnd(-spread*0.3, spread*0.3);
  ball.vx = nx * power + rx;
  ball.vy = ny * power + ry;
  ball.inMotion = true;
}

/* reset helpers */
function resetBall(){ ball.inMotion=false; ball.vx=0; ball.vy=0; ball.x = player.x + 80; ball.y = player.y; }
function resetAfterGoal(){ resetBall(); /* small delay or effect could be added */ }

/* render: draw stadium + players + ball */
function render(){
  // clear
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // stadium background gradient
  const g = ctx.createLinearGradient(0,0,canvas.width,0);
  g.addColorStop(0,'#3f8b2f'); g.addColorStop(1,'#2d7f24');
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

  // stripes
  ctx.globalAlpha = 0.07;
  const stripeW = 48 * (canvas.width/960);
  for(let x=0;x<canvas.width;x+=stripeW*2){ ctx.fillStyle='#5db94b'; ctx.fillRect(x,0,stripeW,canvas.height); }
  ctx.globalAlpha = 1;

  // boundaries
  ctx.strokeStyle = '#fff'; ctx.lineWidth = 2*(canvas.width/960);
  const pad = 40*(canvas.width/960);
  ctx.strokeRect(pad,pad,canvas.width-2*pad,canvas.height-2*pad);

  // center circle
  ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/2, 90*(canvas.width/960), 0, Math.PI*2); ctx.stroke();

  // right penalty + goal
  const gw = 140*(canvas.width/960), gh = 220*(canvas.width/960);
  const gx = canvas.width - pad - gw, gy = (canvas.height - gh)/2;
  ctx.strokeRect(gx, gy, gw, gh);
  ctx.fillStyle = '#fff'; ctx.fillRect(canvas.width - pad - 6*(canvas.width/960), canvas.height/2 - 40*(canvas.width/960), 6*(canvas.width/960), 80*(canvas.width/960));

  // draw keeper & player & ball
  drawPlayer(player);
  drawKeeper(keeper);
  drawBall();

  // flash overlay
  if(flashAlpha>0){
    ctx.fillStyle = flashColor; ctx.globalAlpha = flashAlpha; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.globalAlpha = 1;
  }
}

/* draw helpers (logical->canvas) */
function toCanvasX(x){ return (x / FIELD_W) * canvas.width; }
function toCanvasY(y){ return (y / FIELD_H) * canvas.height; }

function drawPlayer(p){
  const cx = toCanvasX(p.x), cy = toCanvasY(p.y);
  const size = 36*(canvas.width/960);
  // shadow
  ctx.fillStyle='rgba(0,0,0,0.18)'; ctx.beginPath(); ctx.ellipse(cx, cy + size*0.45, size*0.6, size*0.28, 0,0,Math.PI*2); ctx.fill();
  // jersey
  ctx.fillStyle = p.color; roundRect(ctx, cx-size/2, cy-size/2, size, size, 8*(canvas.width/960), true, false);
  // head
  ctx.fillStyle='#f3d7bc'; ctx.beginPath(); ctx.arc(cx, cy - size*0.45, size*0.35, 0, Math.PI*2); ctx.fill();
  // label
  ctx.fillStyle='#fff'; ctx.font = `${12*(canvas.width/960)}px Arial`; ctx.textAlign='center'; ctx.fillText(p.name[0], cx, cy + 6*(canvas.width/960));
}

function drawKeeper(k){
  const cx = toCanvasX(k.x), cy = toCanvasY(k.y);
  const size = 36*(canvas.width/960);
  roundRect(ctx, cx-size/2, cy-size/2, size, size, 8*(canvas.width/960), true, false);
  ctx.fillStyle='#f3d7bc'; ctx.beginPath(); ctx.arc(cx, cy - size*0.45, size*0.35, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle='#fff'; ctx.font = `${12*(canvas.width/960)}px Arial`; ctx.textAlign='center'; ctx.fillText(k.name[0], cx, cy + 6*(canvas.width/960));
}

function drawBall(){
  const cx = toCanvasX(ball.x), cy = toCanvasY(ball.y);
  ctx.beginPath(); ctx.fillStyle = '#fff'; ctx.arc(cx, cy, 8*(canvas.width/960), 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle='#000'; ctx.lineWidth=1; ctx.stroke();
}

/* flash for goal */
let flashAlpha = 0, flashColor = '#fff';
function flash(c){ flashColor = c; flashAlpha = 0.9; setTimeout(()=>flashAlpha = 0,150); }

/* utilities */
function rnd(min,max){ return Math.random()*(max-min)+min; }
function roundRect(ctx,x,y,w,h,r,fill,stroke){ if(typeof r==='undefined') r=6; ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); if(fill){ ctx.fillStyle = (fill===true? '#fff': fill); ctx.fill(); } if(stroke){ ctx.strokeStyle = (stroke===true? '#000': stroke); ctx.stroke(); } }

/* end match */
function endMatch(win){
  state='ended';
  if(timerId) clearInterval(timerId);
  if(rafId) cancelAnimationFrame(rafId);
  resultOverlay.style.display='flex';
  resultTitle.textContent = win ? 'KAZANDIN!' : 'KAYBETTİN';
  resultText.textContent = win ? `Tebrikler — ${goals} gol atarak Isagi'yi yendin.` : `Süre doldu. Goller: ${goals}. Tekrar dene.`;
}

/* reset to cover */
function resetToCover(){
  state='cover';
  cover.style.display='flex';
  gameArea.style.display='none';
  charPanel.style.display='none';
  resultOverlay.style.display='none';
  if(timerId) clearInterval(timerId);
  if(rafId) cancelAnimationFrame(rafId);
}

/* start over after selecting character */
startMatchBtn.addEventListener('click', ()=>{ /* handled above */ });

/* replay/back buttons */
replayBtn.addEventListener('click', ()=>{ resultOverlay.style.display='none'; openCharPanel(); });
backBtn.addEventListener('click', ()=>{ resetToCover(); });

/* expose play button wiring */
function openCharPanel(){ openCharPanelImpl(); }
function openCharPanelImpl(){
  cover.style.display='none';
  charPanel.style.display='flex';
  mobileControls.style.display = isMobile ? 'flex' : 'none';
  state='selecting';
  // populate cards if empty
  if(charsWrap.children.length===0){
    characters.forEach((c,i)=>{
      const div = document.createElement('div');
      div.className = 'charCard' + (i===0? ' active':'');
      div.innerHTML = `<div style="height:64px;display:flex;align-items:center;justify-content:center"><canvas width="96" height="96" style="width:64px;height:64px;border-radius:6px"></canvas></div><div class="charName">${c.id}</div>`;
      div.addEventListener('click', ()=>{ [...charsWrap.children].forEach(ch=>ch.classList.remove('active')); div.classList.add('active'); selectedChar = c; });
      charsWrap.appendChild(div);
      const cv = div.querySelector('canvas'), ct = cv.getContext('2d');
      ct.fi
